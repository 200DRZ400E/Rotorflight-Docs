"use strict";(self.webpackChunkrotorflight_docs=self.webpackChunkrotorflight_docs||[]).push([[6296],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>m});var i=o(67294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,i,r=function(e,t){if(null==e)return{};var o,i,r={},n=Object.keys(e);for(i=0;i<n.length;i++)o=n[i],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)o=n[i],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var s=i.createContext({}),h=function(e){var t=i.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},u=function(e){var t=h(e.components);return i.createElement(s.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var o=e.components,r=e.mdxType,n=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=h(o),c=r,m=d["".concat(s,".").concat(c)]||d[c]||p[c]||n;return o?i.createElement(m,a(a({ref:t},u),{},{components:o})):i.createElement(m,a({ref:t},u))}));function m(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var n=o.length,a=new Array(n);a[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,a[1]=l;for(var h=2;h<n;h++)a[h]=o[h];return i.createElement.apply(null,a)}return i.createElement.apply(null,o)}c.displayName="MDXCreateElement"},97326:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>p,frontMatter:()=>n,metadata:()=>l,toc:()=>h});var i=o(87462),r=(o(67294),o(3905));const n={sidebar_position:100},a="Governor",l={unversionedId:"Tutorial-Setup/Governor",id:"Tutorial-Setup/Governor",title:"Governor",description:"The purpose of the governor is to maintain a constant headspeed regardless of flight inputs, flying conditions, battery voltage, external disturbances, etc. In Rotorflight, the governor also provides other motor related features, like slow spoolup, autorotation control, battery voltage drop compensation, and fault detection and recovery.",source:"@site/docs/Tutorial-Setup/Governor.md",sourceDirName:"Tutorial-Setup",slug:"/Tutorial-Setup/Governor",permalink:"/docs/Tutorial-Setup/Governor",draft:!1,editUrl:"https://github.com/pkaig/Rotorflight-Docs/tree/main/docs/Tutorial-Setup/Governor.md",tags:[],version:"current",sidebarPosition:100,frontMatter:{sidebar_position:100},sidebar:"tutorialSidebar",previous:{title:"RPM Measurement",permalink:"/docs/Tutorial-Setup/Rpm-Measurement"},next:{title:"ESC Telemetry",permalink:"/docs/Tutorial-Setup/ESC-Telemetry"}},s={},h=[{value:"OFF",id:"off",level:3},{value:"PASSTHROUGH",id:"passthrough",level:3},{value:"STANDARD",id:"standard",level:3},{value:"MODE1",id:"mode1",level:3},{value:"MODE2",id:"mode2",level:3},{value:"Spoolup time",id:"spoolup-time",level:3},{value:"Tracking time",id:"tracking-time",level:3},{value:"Recovery time",id:"recovery-time",level:3},{value:"Autorotation bailout time",id:"autorotation-bailout-time",level:3},{value:"Autorotation timeout",id:"autorotation-timeout",level:3},{value:"Autorotation minimum entry time",id:"autorotation-minimum-entry-time",level:3},{value:"Zero Throttle Timeout",id:"zero-throttle-timeout",level:3},{value:"Headspeed Signal Timeout",id:"headspeed-signal-timeout",level:3},{value:"Headspeed Filter Cutoff Hz",id:"headspeed-filter-cutoff-hz",level:3},{value:"Battery Voltage Filter Cutoff Hz",id:"battery-voltage-filter-cutoff-hz",level:3},{value:"TTA Filter Cutoff Hz",id:"tta-filter-cutoff-hz",level:3},{value:"Full Headspeed",id:"full-headspeed",level:3},{value:"PID Master Gain",id:"pid-master-gain",level:3},{value:"P-Gain",id:"p-gain",level:3},{value:"I-Gain",id:"i-gain",level:3},{value:"D-Gain",id:"d-gain",level:3},{value:"Feedforward-Gain",id:"feedforward-gain",level:3},{value:"Cyclic precompensation",id:"cyclic-precompensation",level:3},{value:"Collective precompensation",id:"collective-precompensation",level:3},{value:"THROTTLE &lt; min_check",id:"throttle--min_check",level:3},{value:"min_check &lt; THROTTLE &lt; 1100us",id:"min_check--throttle--1100us",level:3},{value:"1100us &lt; THROTTLE &lt; 1200us",id:"1100us--throttle--1200us",level:3},{value:"1200us &lt; THROTTLE &lt; 2000us",id:"1200us--throttle--2000us",level:3}],u={toc:h},d="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(d,(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"governor"},"Governor"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The purpose of the governor is to maintain a constant headspeed regardless of flight inputs, flying conditions, battery voltage, external disturbances, etc. In Rotorflight, the governor also provides other motor related features, like slow spoolup, autorotation control, battery voltage drop compensation, and fault detection and recovery.")),(0,r.kt)("h1",{id:"governor-feature"},"Governor Feature"),(0,r.kt)("p",null,"The governor can be turned ON/OFF with the feature flag GOVERNOR from the Configuration Tab."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Governor",src:o(35249).Z,width:"925",height:"431"})),(0,r.kt)("p",null,"If the feature is disabled, all governor functions are disabled, and the throttle output is taken directly from the receiver throttle channel."),(0,r.kt)("h1",{id:"governor-modes"},"Governor Modes"),(0,r.kt)("p",null,"Once the governor is enabled the Governor Features panel will be visible on the Motors Tab."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Governor",src:o(20108).Z,width:"777",height:"429"})),(0,r.kt)("p",null,"The governor has multiple operating modes, each using a slightly different method for the throttle control in the PID loop. Select a mode from one of the values below."),(0,r.kt)("h3",{id:"off"},"OFF"),(0,r.kt)("p",null,"The governor is disabled, and the stabilized throttle output ST is taken from the receiver throttle channel."),(0,r.kt)("h3",{id:"passthrough"},"PASSTHROUGH"),(0,r.kt)("p",null,"The governor does not control the headspeed, but provides all the aux functions, like slow spool up, autorotation bailout, and error recovery. In the active state, the receiver throttle channel is directly passed through to the stabilized throttle output ST."),(0,r.kt)("h3",{id:"standard"},"STANDARD"),(0,r.kt)("p",null,"The governor is stabilizing the headspeed with a standard PID control, similar to most ESCs. All aux functions are also active."),(0,r.kt)("h3",{id:"mode1"},"MODE1"),(0,r.kt)("p",null,"Like STANDARD, but with collective/cyclic precompensation. This is similar to governors in most FBL systems."),(0,r.kt)("h3",{id:"mode2"},"MODE2"),(0,r.kt)("p",null,"Like MODE1, but with battery voltage compensation. The PID loop does not need to react to battery voltage fluctuations, as it is taken into account outside the PID loop. This is usually the best choice. Can be used only if the battery voltage is connected to the FC."),(0,r.kt)("h1",{id:"governor-basic-settings"},"Governor Basic Settings"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Governor",src:o(20855).Z,width:"534",height:"496"})),(0,r.kt)("p",null,"In order to use the governor you must first configure the ESC/Motor features. This defines the motor telemetry (for RPM feedback) and gear ratios for your helicopter which lets the flight controller know how fast the rotor is spinning."),(0,r.kt)("h3",{id:"spoolup-time"},"Spoolup time"),(0,r.kt)("p",null,"This is an acceleration limit (in seconds) used for spooling up. It sets the acceleration limit that is equivalent to total time for spooling up from zero to full headspeed. For example, with a value of 10 and full headspeed of 3000rpm, the main rotor would take 10s to reach 3000rpm."),(0,r.kt)("h3",{id:"tracking-time"},"Tracking time"),(0,r.kt)("p",null,"Acceleration limit (in seconds) for normal operation. This occurs when the requested headspeed command changes while the governor is in the active state. This parameter limits the rpm change speed (acceleration). For example, when set to a value of 10 (which is 10s to ramp 0-100%). If hovering in Normal mode at 1500rpm (50% throttle) and then switching to Idl3 of 3000rpm (100% throttle) the Governor would ramp over 5s. Typical value is 5..20."),(0,r.kt)("h3",{id:"recovery-time"},"Recovery time"),(0,r.kt)("p",null,"Acceleration limit (in seconds) for error recovery. When the governor is recovering from lost headspeed or lost throttle signal, this is the max acceleration for the following (faster) spoolup."),(0,r.kt)("h3",{id:"autorotation-bailout-time"},"Autorotation bailout time"),(0,r.kt)("p",null,"Acceleration limit (in seconds) for autorotation bailout. When the governor is spooling up from autorotation, it is limiting the spoolup speed with this parameter."),(0,r.kt)("h3",{id:"autorotation-timeout"},"Autorotation timeout"),(0,r.kt)("p",null,"In the autorotation state, if high throttle returns before this timeout expires, the spoolup is done with bailout acceleration. After the expiration, the governor enters the idle state, and any subsequent spoolup is slow."),(0,r.kt)("h3",{id:"autorotation-minimum-entry-time"},"Autorotation minimum entry time"),(0,r.kt)("p",null,"Minimum flight time before Autorotation can be engaged."),(0,r.kt)("h3",{id:"zero-throttle-timeout"},"Zero Throttle Timeout"),(0,r.kt)("p",null,"When the throttle input (from receiver) goes to zero, the governor enters an intermediate state where it is waiting for the throttle to return. If the throttle returns before this timeout expires, the spoolup is done with the recovery acceleration. If the timeout expires, the governor enters off state, and any future spoolup will be slow."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The purpose of this feature is to allow fast spoolup in case the throttle cut (hold) is hit accidentally.\nIf high throttle is returned very soon after, the heli will spool up quickly and hopefully keep on flying. Unit is 0.1s.\nTypical value is 5..50.")),(0,r.kt)("h3",{id:"headspeed-signal-timeout"},"Headspeed Signal Timeout"),(0,r.kt)("p",null,"If the headspeed rpm signal is lost, the governor enters an intermediate state where it is waiting for the rpm signal to return. If the signal returns before this timeout expires, the spoolup is done with the recovery acceleration. If the timeout expires, the governor enters the idle state, and any future spoolup would happen with the default (slow) spoolup acceleration. Unit is 0.1s. Typical value is 5..50."),(0,r.kt)("h3",{id:"headspeed-filter-cutoff-hz"},"Headspeed Filter Cutoff ","[Hz]"),(0,r.kt)("p",null,"The inputs to the governor must be clean from excess noise. The RPM input is filtered with a BIQUAD filter, with the frequency cutoffs set by these variables."),(0,r.kt)("h3",{id:"battery-voltage-filter-cutoff-hz"},"Battery Voltage Filter Cutoff ","[Hz]"),(0,r.kt)("p",null,"The inputs to the governor must be clean from excess noise. The Battery voltage input is filtered with a BIQUAD filter, with the frequency cutoffs set by these variables."),(0,r.kt)("h3",{id:"tta-filter-cutoff-hz"},"TTA Filter Cutoff ","[Hz]"),(0,r.kt)("p",null,"Filter to smooth the Yaw signal before it is used for the TTA function (Torque Tail Assist)"),(0,r.kt)("h1",{id:"governor-profiles-settings"},"Governor Profiles Settings"),(0,r.kt)("p",null,"These settings are set from the Profiles Tab. If desired, individual Profiles can be configured via the Adjustments Tab. This enables individual flight modes to have separate tuning and configuration set for each flight mode. (similar to 'Bank Switching')."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Governor",src:o(35167).Z,width:"1280",height:"271"})),(0,r.kt)("h3",{id:"full-headspeed"},"Full Headspeed"),(0,r.kt)("p",null,"This is the highest headspeed that the governor would ever try to maintain, when the throttle input is at 100%."),(0,r.kt)("h3",{id:"pid-master-gain"},"PID Master Gain"),(0,r.kt)("p",null,"Master gain multiplier"),(0,r.kt)("h3",{id:"p-gain"},"P-Gain"),(0,r.kt)("p",null,"Governor Proportional gain"),(0,r.kt)("h3",{id:"i-gain"},"I-Gain"),(0,r.kt)("p",null,"Governor Integral gain"),(0,r.kt)("h3",{id:"d-gain"},"D-Gain"),(0,r.kt)("p",null,"Governor Derivative gain"),(0,r.kt)("h3",{id:"feedforward-gain"},"Feedforward-Gain"),(0,r.kt)("p",null,"Governor Feedforward gain"),(0,r.kt)("h3",{id:"cyclic-precompensation"},"Cyclic precompensation"),(0,r.kt)("p",null,"Cyclic precompensation weight. Increasing the cyclic increases load on the rotor and causes it to slow down. This setting determines how much cyclic is mixed into the governor feedforward. This helps the governor maintain the headspeed proactively (i.e. increase power to the motor so it does not slow down). Usually 20..100"),(0,r.kt)("h3",{id:"collective-precompensation"},"Collective precompensation"),(0,r.kt)("p",null,"Collective precompensation weight. Increasing the collective increases load on the rotor and causes it to slow down. This setting determines how much collective is mixed into the governor feedfoward. This helps the governor maintain the headspeed proactively (i.e. increase power to the motor so it does not slow down). Usually 20..100"),(0,r.kt)("h1",{id:"governor-throttle-input-ranges"},"Governor throttle input ranges"),(0,r.kt)("p",null,"With the governor feature activated, the transmitter throttle channel is controlling the governor, rather than the ESC directly."),(0,r.kt)("p",null,"Depending in which range the throttle value falls into, the governor will function differently."),(0,r.kt)("h3",{id:"throttle--min_check"},"THROTTLE < min_check"),(0,r.kt)("p",null,"This throttle value indicates throttle hold (throttle cut) condition. It's guaranteed that all motors are stopped immediately. The throttle output from the governor is guaranteed to be zero."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Make sure your transmitter is sending a value lower than min_check when throttle hold is activated."),(0,r.kt)("p",{parentName:"admonition"},"Throttle hold SHOULD NOT be used for autorotation.")),(0,r.kt)("h3",{id:"min_check--throttle--1100us"},"min_check < THROTTLE < 1100us"),(0,r.kt)("p",null,"In this range, the governor is in idle or autorotation state, and the output is zero - the main motor is stopped."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Motorized tail is fully active in this range."),(0,r.kt)("p",{parentName:"admonition"},"If you want to perform autorotation with the main motor stopped, use this range!")),(0,r.kt)("h3",{id:"1100us--throttle--1200us"},"1100us < THROTTLE < 1200us"),(0,r.kt)("p",null,"In this range, the governor is in idle or autorotation state, and the output is in 0% - 10%, increasing linearly through the range."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Motorized tail is fully active in this range."),(0,r.kt)("p",{parentName:"admonition"},"If you want to perform autorotation with the main motor running, use this range!")),(0,r.kt)("h3",{id:"1200us--throttle--2000us"},"1200us < THROTTLE < 2000us"),(0,r.kt)("p",null,"In this range, the governor is in active state, and the requested rpm is 20%..100% of the gov_headspeed."),(0,r.kt)("h1",{id:"governor-state"},"Governor State"),(0,r.kt)("p",null,"The governor internal state can be observed in the blackbox log. It is a good indication on what the governor is trying to do."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"OFF")," The governor is disabled and the throttle output is zero."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"IDLE")," The governor is idle, because the input throttle is in the idle range. The throttle output is as described above - 0..10%."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"SPOOLING_UP")," The input throttle has transitioned from low to high, and the governor is spooling up slowly."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ACTIVE")," The governor has reached the target headspeed and is actively maintaining it."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"LOST_THROTTLE")," The throttle signal has suddenly dropped from high to low. If the throttle returns quickly, a recovery spoolup is performed. This state is for convenience, when the pilot accidentally hits throttle hold, and then realizes the mistake."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"LOST_HEADSPEED")," The RPM input signal is lost. The governor will wait for a little while for the signal to return, before spooling down. It the signal returns quickly, a recovery spoolup is performed."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"RECOVERY")," The governor is performing a recovery spoolup after one of the conditions above."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"AUTOROTATION")," The throttle has dropped from high to the autorotation range. The governor is expecting the throttle to return once the autorotation has been performed. Once the throttle return, the governor moves to the state below."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"AUTOROTATION_BAILOUT")," Throttle has returned while in AutoRotation state, and the governor is performing an autorotation bailout."))}p.isMDXComponent=!0},35249:(e,t,o)=>{o.d(t,{Z:()=>i});const i=o.p+"assets/images/governor-1-a02105e5605be1b20c7c2e79c15a6010.png"},20108:(e,t,o)=>{o.d(t,{Z:()=>i});const i=o.p+"assets/images/governor-2-10a425f73e06b8fccc97925a42ffc946.png"},20855:(e,t,o)=>{o.d(t,{Z:()=>i});const i=o.p+"assets/images/governor-3-55cb78f9acf2417778fbd1e362470167.png"},35167:(e,t,o)=>{o.d(t,{Z:()=>i});const i=o.p+"assets/images/governor-4-66f70cd01cee1d6739ff52c9ffa3c9fc.png"}}]);